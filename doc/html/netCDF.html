<html>
<head>

<title>NCAR-RAF netCDF Conventions</title>
   <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">

<style type="text/css">
<!--
body { background: white; color: black; margin: 2em; margin-left: 3em; }
h1,h2 { font-size: 1.5em }
h3 { font-size: 1.3em }
h4 { font-size: 1.2em }
h1, h2, h3, h4 { font-style: normal; font-weight: normal; color: #3860B0; }
span.runin { font-size: 1.1em; font-weight: bold; color: #3860B0; }
a:link { color:navy; }
a:visited { color:#386090; }
li.toc { list-style: none; padding: .1em; }
kbd.att { font-weight: normal; color: blue; }
div.example { margin-left: 3em; margin-right: 3em; }
div.definition { margin-left: 1em; }
div.sidebar { margin-left: 50px; margin-right: 50px; padding: 20px; background-color: #f5deb4; }
pre.CDL { color: brown; }
table { padding: .25em; }
span.new { background-color: #FF6666; }
span.old { background-color: #FFFF88; text-decoration: line-through; }
span.comment { background-color: #88FF88; font-style: italic; }
-->
</style>

</head>

<body>

<h1 align=center>NCAR-RAF netCDF Conventions</h1>
<h3 align=center>Version 1.3</h3>
<hr>
<h4 align=center>National Center for Atmospheric Research</h4>
<h4 align=center>Research Aviation Facility</h4>
<h4 align=center>NOAA AOC (GIV)</h4>
<h4 align=center>University of Wyoming (King Air)</h4>

<!--------------------------------------------------------------------------- ABS -->

<hr>
<h2><a name="toc">Table of Contents</a></h2>

<ul>
<li class="toc"><a href="#intro">Introduction</a></li>
  <ul>
  </ul>
<li class="toc"><a href="#file">NetCDF Files and Components</a></li>
  <ul>
  <li class="toc">1 &nbsp;<a href="#fname">Filename</a></li>
  <li class="toc">2 &nbsp;<a href="#dtype">Data types</a></li>
  <li class="toc">3 &nbsp;<a href="#names">Naming conventions</a></li>
  <li class="toc">4 &nbsp;<a href="#dims">Dimensions</a></li>
  <li class="toc">5 &nbsp;<a href="#vars">Variables</a></li>
  <li class="toc">6 &nbsp;<a href="#atts">Attributes</a></li>
  </ul>
</ul>

<h2><a>Appendices</a></h2>

<ul>
<li class="toc">A &nbsp;<a href="#ref_app">References</a></li>
<li class="toc">B &nbsp;<a href="#pms1d_app">PMS1D Probe Variables Description</a></li>
</ul>



<hr>
<h2 align=center><a name="intro">Introduction</a></h2>
The goal is to support synchronous time series including the following properties:
<p>
<ul>
<li>Both scalar and vector variables.
<li>Different sample rates among variables
</ul>
<p>
RAF's primary datasets consist of synchronous time series data.  Data are
written to the netCDF file one record per second, even for data at higher rates.
<p>
Data acquisition of numerous instruments at high-rate (from 1 to 5K samples
per second) for 10 to 11 hours can produce large data files.  Typical,
raw packed data files from the NCAR C-130 are 600MB, and unpacked with
no data reduction would be twice that size.  Files reduced to 1 sample
per second (sps) are typically 70-100MB.
<p>
<h4>1.0.1 Vector data</h4>
Instruments which measure particle size distributions produce histograms or
vector data.  These instruments include the suite of PMS-1D probes, the RDMA
and quantitative data reduction from the PMS-2D probes.
<p>
<b>Note:</b> For <b>all</b> size-distributions (PMS1D, PMS2D, RDMA) the
zeroth or first (depending on how you count) bin is undefined, do not use
this value.  Attributes for the various size distribution variables should
include <kbd class="att">FirstBin</kbd> and <kbd class="att">LastBin</kbd>.
<p>
<h4>1.0.2 Multi-rate files</h4>
RAF's standard data product is a netCDF file where all measurements are
output at 1 sps.  Certain projects require high-rate data.  RAF has
standardized at 25 sps for high-rate data.  In general we don't want to
put out variables sampled at 1 sps at 25 sps, as there is no information
in the data, and it would take up excess space.
<p>
There is also an occasional need to look at data at the sample rate. 
<p>
<img src="http://www.eol.ucar.edu/raf/Software/record.png" align=center>
<p>

<!--------------------------------------------------------------------------- ABS -->

<hr>
<h2 align=center><a name="file">NetCDF File Component Descriptions</a></h2>


<!--------------------------------------------------------------------------- ABS -->

<h3><a name="fname">1 Filename</a></h3>

<p>RAF uses a naming convention consisting of the 3 digit project number,
followed by the flight type, followed by a 2 digit flight number, followed
by "<kbd>.nc</kbd>".
<p>

e.g.<br>
<div class="example">

<span class="runin">217tf01.nc</span> would be <b>test</b> flight 1 from project 217.<br>
<span class="runin">131ff01.nc</span> would be <b>ferry</b> flight 1 from project 131.<br>
<span class="runin">803rf17h.nc</span> would be high-rate data from <b>research</b> flight 17 of project 803.<br>
</div>
<p>
Flight types used by RAF are "ff", "tf", and "rf".
<p>

<!--------------------------------------------------------------------------- ABS -->

<h3><a name="dtype">2 Data types</a></h3>

All data are stored using type <kbd>float</kbd>, except for <b>base_time</b> which is
of type <kbd>int</kbd>.
<p>

<!--------------------------------------------------------------------------- ABS -->

<h3><a name="names">3 Naming conventions</a></h3>

Variable, dimension and attribute names should begin with a letter and be
composed of letters, digits, and underscores.
<p>
<h4>3.1 Variable names</h4>
The <b>underscore</b> has special meaning for variable names.  Anything
following an underscore is considered a suffix for grouping variables from
the same instrument or probe.  There is no standard for suffix names, but
RAF regularly uses about a dozen specific ones for describing an instrument's
mounting location on the aircraft.
<p>

e.g.,<br>
<div class="example">

<span class="runin">AFSSP_RPO</span>,
<span class="runin">CFSSP_RPO</span>,
<span class="runin">PLWC_RPO</span>,
<span class="runin">CONCF_RPO</span>
all belong to the same intrument.
</div>
<p>
In our files RPO stands for "Right Pod Outboard".
<p>
<h4>3.2 Dimension names</h4>
Dimension names we use are:
<ul>
<li><kbd>sps#</kbd> for variable data rate (sps1, sps5, sps25, sps1000, etc.)
<li><kbd>Vector#</kbd> for vector lengths (Vector16, Vector41, etc.)
</ul>
although I don't believe it matters what they are called.
<p>

<!--------------------------------------------------------------------------- ABS -->

<h3><a name="dims">4 Dimensions</a></h3>
<h4>4.1 First dimension - Time</h4>
<p><b>Time</b> is the <b>unlimited dimension</b>, and every variable (except
<b>base_time</b>) has the <b>Time</b> dimension.  No more than one record
is to be written per second; all high-rate data are to be contained "per
record", though data averaged down slower than 1 sps may be written (e.g.,
when you have 1 sample every 10 seconds).
<p>
<h4>4.2 Second dimension - data rate</h4>
The second dimension, if present, represents the number of samples
per second.  The size of this dimension will vary according to the output
rate of the variable (e.g., RAF uses 1, 5, 10, 25, 50, 250, and 1000).
If the dimension does not exist, then there is only one sample for the second.
<p>
<h4>4.3 Third dimension - vector length</h4>
The third dimension, if present, is the vector length of the data.
(This will be present only for variables with vector data).  Only PMS-1D
probes are producing vector data at this time.
<p>
A new dimension has been added called <b>Async</b>.  <b>Async</b> is a
triplet containing the location of the asynchronous data in a separate
binary "heap" file.  The first value contains the offset in bytes into the
file of the first record for that second, the second number tells the record
length, and the third is the number of records for that particular second.
<b>Async</b> will always be in the 3rd (or Vector) dimension, e.g., float
2D-P_LPI(Time, sps1, Async).  <b>Async</b> was added to facilitate future
capabilities of being able to provide satellite images, PMS-2D data, and other
asynchronous products into one "heap" file.  (Note:  I have yet to use this
feature, so implementation of file name, etc., are incomplete).
<p>

<!--------------------------------------------------------------------------- ABS -->

<h3><a name="vars">5 Variables</a></h3>

http://www.cfconventions.org/.
<h4>5.1 Time</h4>
Time follows the recomendations set forth in the <a href="http://cf-pcmdi.llnl.gov/documents/cf-conventions/1.0/cf-conventions.html">CF conventions section 4.4</a>.
<pre class="CDL">
        int Time(Time) ;
                Time:long_name = "time of measurement" ;
                Time:standard_name = "time" ;
                Time:units = "seconds since 2004-08-02 16:46:11 +0000" ;
                Time:strptime_format = "seconds since %F %T %z" ;
</pre>

<p>
<div class="sidebar">
Pre version 1.3 time was represented as follows, it is still included for
backwards compatibility but is being deprecated.
<p>
Time is stored as a <b>base_time</b> and <b>time_offset</b> pair.
<b>base_time</b> is standard Unix time (seconds since Jan 1, 1970),
and is typically the time stamp of the first record in the file.
<b>base_time</b> has only one value, and does not contain the time
dimension.  <b>time_offset</b> is added to <b>base_time</b> to give
the time of the current record.

<pre class="CDL">
        int base_time ;
                base_time:units = "seconds since 1970-01-01 00:00:00 +0000" ;
                base_time:long_name = "Start time of data recording." ;
        float time_offset(Time) ;
                time_offset:long_name = "Seconds since base_time." ;
                time_offset:units = "seconds since 2004-08-02 16:46:11 +0000" ;
</pre>
</div>

<p>
<h4>5.2 Missing data</h4>
At this time we use the <kbd class="att">_FillValue</kbd> attribute.
<p>
<div class="sidebar">
Prior to 01/27/2003 we used <kbd class="att">missing_value</kbd> as the missing
value.  <kbd class="att">missing_value</kbd> (pre 1998 spelled <kbd class="att">MissingValue</kbd>) is being deprecated.
</div>
<p>

<!--------------------------------------------------------------------------- ABS -->

<h3><a name="atts">6 Attributes</a></h3>
<h4>6.1 Global attributes</h4>
<p>
<pre class="CDL">
// global attributes:
                :Source = "NCAR Research Aviation Facility" ;
                :Address = "P.O. Box 3000, Boulder, CO 80307-3000" ;
                :Phone = "(303) 497-1030" ;
                :Conventions = "NCAR-RAF/nimbus" ;
                :ConventionsURL = "http://www.eol.ucar.edu/raf/Software/netCDF.html" ;
                :ConventionsVersion = "1.3" ;
                :ProcessorRevision = "3213" ;
                :ProcessorURL = "http://svn/svn/raf/trunk/nimbus" ;
                :DateProcessed = "2006-02-17 16:57:57 -0700" ;
                :ProjectName = "TREX" ;
                :Platform = "N677F" ;
                :ProjectNumber = "503" ;
                :FlightNumber = "tf01" ;
                :FlightDate = "02/17/2006" ;
                :coordinates = "LONC LATC GGALT Time" ;
                :wind_field = "WSC WDC WIC" ;
                :landmarks = "39.9083 -105.116 BJC,40.25 -103.799 FtMrg,43.5838 -96.7346 FSD,46.8392 -92.1897 DLH,32.9048 -97.0459 DFW,36.0847 -115.151 LAS,40.7858 -111.979 SLC,33.4358 -112.013 PHX,45.5894 -122.592 PDX,33.9436 -118.403 LAX" ;
                :TimeInterval = "00:03:16-01:29:43" ;
</pre>
<p>
<kbd class="att">coordinates</kbd> is required starting with version 1.3.  These
are the aircrafts "best" position variables.<br>
<kbd class="att">TimeInterval</kbd> is required by <b>ncplot</b> and <b>ncpp</b>, but I hope to get away from that.

<h4>6.2 Variable attributes</h4>
<p>All variables contain the basic attributes <kbd class="att">units</kbd>,
<kbd class="att">long_name</kbd>, and <kbd class="att">_FillValue</kbd>
(<kbd class="att">missing_value</kbd> is being deprecated).  In addition
we provide some other attributes; not all are used for every variable:
<p>
<kbd class="att">standard_name</kbd> we have adopted the CF
<a href="http://cf-pcmdi.llnl.gov/documents/cf-conventions/1.0/cf-conventions.html">CF conventions section 3.3</a>
use of standard_name where applicable.
<p>
<kbd class="att">SampledRate</kbd> is the rate (sps) at which the variable was
sampled onboard the aircraft.  This does not apply to derived variables.
<p>
<kbd class="att">DataQuality</kbd> attempts to inform the user of the quality
of these data.  Some values are <kbd>Bad</kbd>, <kbd>Preliminary</kbd> and
<kbd>Good</kbd>
<p>
<kbd class="att">Category</kbd> Since a file can contain hundreds of variables
with not very descriptive names, this is provided to help create sub-lists of
variables.  Comma separated list.
<p>
<kbd class="att">CalibrationCoefficients</kbd> are the values used to produce
engineering units from a measurement's DC voltage.  It is used by the
analog/digital group.  <b>These values have already been applied!</b>  They
are present for documentation.
<p>
<kbd class="att">Dependencies</kbd> are the input variables that were used to
produce this derived value.  Like <kbd class="att">CalibrationCoefficients</kbd>
, these are present for documentation.
<p>
For processing purposes, variables in <b>our</b> files are organized into 3
sorted lists.  The first sorted list consists of Analog or Digitally-sampled
variables.  These only have calibration coefficients applied to them.  The
second group is raw data from "block" probes (e.g., PMS1D, IRS, GPS, and a
few from group 1 that need special processing).  The third group consists
of purely derived variables.  I have included one example from each of the
3 groups (which also show different dimension schemes):
<pre class="CDL">
        float ADIFR(Time) ;
                ADIFR:units = "mbar" ;
                ADIFR:long_name = "Vertical Differential Pressure, Radome" ;
                ADIFR:Category = "Uncorr\'d Raw" ;
                ADIFR:_FillValue = -32767.f ;
                ADIFR:SampledRate = 25 ;
                ADIFR:DataQuality = "Preliminary" ;
                ADIFR:CalibrationCoefficients = -0.0115f, 5.1637f, 0.001f ;

        float AFSSP_RPC(Time, sps1, Vector16) ;
                AFSSP_RPC:units = "count" ;
                AFSSP_RPC:long_name = "FSSP-100 Raw Accumulation (per cell)" ;
                AFSSP_RPC:Category = "PMS Probe" ;
                AFSSP_RPC:_FillValue = -32767.f ;
                AFSSP_RPC:SampledRate = 10 ;
                AFSSP_RPC:DataQuality = "Preliminary" ;
                AFSSP_RPC:SerialNumber = "FSSP076" ;
                AFSSP_RPC:FirstBin = 1 ;
                AFSSP_RPC:LastBin = 15 ;
                AFSSP_RPC:CellSizes = 2.f, 5.f, 8.f, 11.f, 14.f, 17.f, 20.f, 23.f, 26.f, 29.f, 32.f, 35.f, 38.f, 41.f, 44.f, 47.f, 2.f, 4.f, 6.f, 8.f, 10.f, 12.f, 14.f, 16.f, 18.f, 20.f, 22.f, 24.f, 26.f, 28.f, 30.f, 32.f, 1.f, 2.f, 3.f, 4.f, 5.f, 6.f, 7.f, 8.f, 9.f, 10.f, 11.f, 12.f, 13.f, 14.f, 15.f, 16.f, 0.5f, 1.f, 1.5f, 2.f, 2.5f, 3.f, 3.5f, 4.f, 4.5f, 5.f, 5.5f, 6.f, 6.5f, 7.f, 7.5f, 8.f ;
                AFSSP_RPC:CellSizeUnits = "micrometers" ;
                AFSSP_RPC:DepthOfField = 2.7f ;
                AFSSP_RPC:BeamDiameter = 0.18f ;
                AFSSP_RPC:Density = 1.f ;
                AFSSP_RPC:PLWfactor = 1.e-06f ;
                AFSSP_RPC:DBZfactor = 1000000.f ;

        float WIC(Time, sps25) ;
                WIC:units = "m/s" ;
                WIC:long_name = "GPS-Corrected Wind Vector, Vertical Gust Component" ;
                WIC:standard_name = "wind_from_direction" ;
                WIC:Category = "Wind" ;
                WIC:_FillValue = -32767.f ;
                WIC:DataQuality = "Good" ;
                WIC:Dependencies = "9 TASX VEWC VNSC PITCH ROLL THDG ATTACK SSLIP VSPD" ;
</pre>

<p>

<h2>Appendices</h2>

<h3><a name="ref_app">A &nbsp;References</a></h3>
<dl>
<dt><a name="ref_nc">[NetCDF]</a></dt>
  <dd><a href="http://www.unidata.ucar.edu/packages/netcdf/index.html">NetCDF
  Software Package</a>, from the UNIDATA Program Center of the University
  Corporation for Atmospheric Research.
  </dd>

<dt><a name="ref_units">[UDUNITS]</a></dt>
  <dd><a href="http://www.unidata.ucar.edu/packages/udunits/">UDUNITS
  Software Package</a>, from the UNIDATA Program Center of the University
  Corporation for Atmospheric Research.
  </dd>

</dl>

<h3><a name="pms1d_app">B &nbsp;PMS1D Probe Variables Description</a></h3>

<p>
<h4>B.1 Variable names</h4>

Each PMS probe has two vectors (histograms) stored in the netCDF file.  First is the raw
counts and this variable always starts with the letter 'A' (for "Actual").  Second is the
concentration array which always starts with the letter 'C'.  Below you will see the variable
names for the orginal PMS probe and for the DMT converted electronics.
<p>
<table border=1>
 <tr><th>PMS1D</th><th># bins</th><th>Counts name</th><th>Concentration name</th><th>DMT Converted</th><th># bins</th><th>Counts name</th><th>Concentration name</th></tr>
 <tr><td>FSSP</td><td>16</td><td>AFSSP_xxx</td><td>CFSSP_xxx</td><td>S100</td><td>31</td><td>AS100_xxx</td><td>CS100_xxx</td></tr>
 <tr><td>PCASP</td><td>16</td><td>APCAS_xxx</td><td>CPCAS_xxx</td><td>S200</td><td>31</td><td>AS200_xxx</td><td>CS200_xxx</td></tr>
 <tr><td>F300</td><td>32</td><td>AF300_xxx</td><td>CF300_xxx</td><td>S300</td><td>31</td><td>AS300_xxx</td><td>CS300_xxx</td></tr>
 <tr><td>260X</td><td>64</td><td>A260X_xxx</td><td>C260X_xxx</td><td>----</td><td>--</td><td></td><td></td></tr>
 <tr><td>2D-C</td><td>32</td><td>A1DC_xxx1</td><td>C1DC_xxx1</td><td>----</td><td>--</td><td></td><td></td></tr>
 <tr><td>2D-C</td><td>64</td><td>A2DC_xxx2</td><td>C2DC_xxx2</td><td>----</td><td>--</td><td></td><td></td></tr>
</table>
<p>
Two sets of arrays are produced for each 2D probe.  The 1DC pair is the produced from the 2D
probe data using an "entire-in" algorithm.  The 2DC pair is produced using a "center-in"
algorithm.

<p>
<h4>B.2 Number of bins</h4>
The original PMS probes always had the first (zeroth) bin set to zero or a value
which was not part of the size-distribution histogram (e.g. the FSSP-100 recorded
16 bins of which the last 15 contained data).  However we wanted all raw data
available to an investigator.  For consistency this required the concentration
array to be the same size, so it's first (zeroth) bin is also set to zero.
<p>
DMT converted probes can record either 10, 20, 30 or 40 bins of data.  To maintain
backwards compatability, we pad the front of the array with a zero and increase the
number of bins by one (11, 21, 31 or 41).
<p>
<b>NOTE: Always ignore the very first bin of any size-distribution histogram in
our netCDF files.</b>

<p>
<h4>B.3 Cell sizes</h4>
Cell sizes are stored as an attribute of the counts array.  They are <b>end-points</b>.
In the example below, there are 31 cell sizes to go with the 30 used values of the size-
distribution.  Also note the attributes <b>FirstBin</b> and <b>LastBin</b>, these should
be used to determine which bins are considered valid, both are inclusive.

<pre class="CDL">
        float AS100_LPC(Time, sps1, Vector31) ;
                AS100_LPC:_FillValue = -32767.f ;
                AS100_LPC:units = "count" ;
                AS100_LPC:long_name = "FSSP-100 Raw Accumulation (per cell) - DMT" ;
                AS100_LPC:Category = "PMS Probe" ;
                AS100_LPC:missing_value = -32767.f ;
                AS100_LPC:SampledRate = 10 ;
                AS100_LPC:DataQuality = "Preliminary" ;
                AS100_LPC:SerialNumber = "FSSP122" ;
                AS100_LPC:FirstBin = 3 ;
                AS100_LPC:LastBin = 30 ;
                AS100_LPC:CellSizes = 0.7f, 1.4f, 2.35f, 3.9f, 5.45f, 7.f, 8.55f, 10.1f, 11.65f, 13.2f, 14.75f, 16.3f, 17.85f, 19.4f, 20.95f, 22.5f, 24.05f, 25.6f, 27.15f, 28.7f, 30.25f, 31.8f, 33.35f, 34.9f, 36.45f, 38.f, 39.55f, 41.1f, 42.65f, 44.2f, 45.75f ;
                AS100_LPC:CellSizeUnits = "micrometers" ;
                AS100_LPC:DepthOfField = 2.3f ;
                AS100_LPC:BeamDiameter = 0.2f ;
                AS100_LPC:Density = 1.f ;
                AS100_LPC:PLWfactor = 1.e-06f ;
                AS100_LPC:DBZfactor = 1000000.f ;

        float CS100_LPC(Time, sps1, Vector31) ;
                CS100_LPC:_FillValue = -32767.f ;
                CS100_LPC:units = "#/cm3" ;
                CS100_LPC:long_name = "FSSP-100 Concentration (per cell) - DMT" ;
                CS100_LPC:Category = "PMS Probe" ;
                CS100_LPC:missing_value = -32767.f ;
                CS100_LPC:DataQuality = "Preliminary" ;
                CS100_LPC:Dependencies = "5 AS100_LPC TASX REJAT_LPC OVFLW_LPC FRNG_LPC" ;

        float CONCF_LPC(Time) ;
                CONCF_LPC:_FillValue = -32767.f ;
                CONCF_LPC:units = "#/cm3" ;
                CONCF_LPC:long_name = "FSSP-100 Concentration (all cells)" ;
                CONCF_LPC:Category = "PMS Probe" ;
                CONCF_LPC:missing_value = -32767.f ;
                CONCF_LPC:DataQuality = "Preliminary" ;
                CONCF_LPC:Dependencies = "1 CS100_LPC" ;
</pre>
<p>
<table border=1>
 <tr><th>bin#</th><th>0</th><th>1</th><th>2</th><th>3</th><th>....</th><th>29</th><th>30</th></tr>
 <tr><td></td><td>n/a</td><td></td><td></td><td>FirstBin</td><td></td><td></td><td>LastBin</td></tr>
</table>


<!--------------------------------------------------------------------------- ABS -->
<hr>
For further information contact:
<p>
Chris Webster<br>
National Center for Atmospheric Research<br>
Research Aviation Facility<br>
(303) 497-1044
<p>
<address><a href="mail&#116;&#111;:cjw&#064;ucar.edu?Subject=from_RAF_Web_Software_Page_netCDF">email</a></address>
<hr>
<font size=2>
Last update:
Sat Feb 18 15:06:44 MST 2006
</font>
</body>
</html>
